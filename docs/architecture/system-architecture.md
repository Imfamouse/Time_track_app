# Архитектура системы

## Компоненты
- **Frontend (React/Vite)**: SPA, взаимодействует с backend через REST и GraphQL, использует корпоративный SSO прокси.
- **Backend API (FastAPI)**: реализует бизнес-логику, управление задачами, отчётами и аутентификацию.
- **Background Worker**: отдельный процесс (Celery + Redis) для обработки уведомлений и пакетных задач (например, агрегация отчётности).
- **Database**: PostgreSQL 16 с строгими схемами и контролем миграций.
- **Message Broker/Cache**: Redis 7 для очередей уведомлений и кэширования справочных данных.
- **File Storage**: использование корпоративного SMB-шара для экспорта отчётов; в разработке — локальная директория (оборачивается в Docker volume).
- **CI/CD Pipeline**: GitHub Actions (разработка) + корпоративный Jenkins (прод).

## Взаимодействия
1. Пользователь проходит SSO через корпоративный прокси, получает Kerberos ticket.
2. Frontend получает временный токен от Backend (обмен по SPNEGO/Negotiate). Для локальной разработки используется JWT-мок.
3. Backend обращается к PostgreSQL через SQLAlchemy, кэширует справочники в Redis.
4. Для массовых уведомлений Backend ставит задания в очередь Celery, которая отправляет e-mail через SMTP-шлюз.
5. Отчётность формируется через SQL запросы и агрегаты; тяжёлые отчёты исполняются в background worker.

## Разделение на модули Backend
- `core`: конфигурация, безопасность, инфраструктура.
- `users`: управление пользователями, ролями, подразделениями.
- `projects`: проекты и задачи.
- `time_reports`: отчёты сотрудников и согласование.
- `analytics`: агрегаты и отчётность.
- `notifications`: события и рассылка.

## Нефункциональные аспекты
- **Безопасность**: RBAC на уровне API, аудит операций в таблице `audit_log`.
- **Производительность**: индексы по ключевым атрибутам (проект, период, сотрудник), кэширование агрегатов.
- **Надёжность**: резервные копии PostgreSQL (pgBackRest), мониторинг через Prometheus/Grafana.

## Деплой и окружения
- **Dev**: Docker Compose (`backend`, `frontend`, `db`, `redis`, `worker`).
- **Stage/Prod**: контейнеры, развёрнутые на Windows Server 2012 R2 через Docker Enterprise; внешняя СУБД PostgreSQL на выделенном сервере Linux.
- **CI**: GitHub Actions выполняет линтеры и тесты; артефакты публикуются в корпоративный артефактори.

## Будущие шаги
- Проработать контракты API и схемы GraphQL.
- Подготовить диаграммы последовательности для ключевых сценариев.
